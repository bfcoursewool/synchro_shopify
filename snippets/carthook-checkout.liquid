{% if customer %}
	<script  type="text/javascript">
		window.ch_cust_param = 'customer_id={{customer.id}}&customer_email={{customer.email}}&email={{customer.email}}';
		var ch_sd = btoa(JSON.stringify({
			"id": {{customer.id | json}},
			"email": {{customer.email | json}},
			"default_address": {{customer.default_address | json}},
			"accepts_marketing": {{customer.accepts_marketing | json}},
			"tags": {{customer.tags | json}}
		}));
		sessionStorage.setItem("ch_sd", ch_sd);
	</script>

{% endif %}

<script type="text/javascript">
	// https://github.com/taylorhakes/promise-polyfill
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){"use strict";function e(){}function n(e){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=undefined,this._deferreds=[],f(e,this)}function t(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,n._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var i;try{i=n(e._value)}catch(f){return void r(t.promise,f)}o(t.promise,i)}else(1===e._state?o:r)(t.promise,e._value)})):e._deferreds.push(t)}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var o=t.then;if(t instanceof n)return e._state=3,e._value=t,void i(e);if("function"==typeof o)return void f(function(e,n){return function(){e.apply(n,arguments)}}(o,t),e)}e._state=1,e._value=t,i(e)}catch(u){r(e,u)}}function r(e,n){e._state=2,e._value=n,i(e)}function i(e){2===e._state&&0===e._deferreds.length&&n._immediateFn(function(){e._handled||n._unhandledRejectionFn(e._value)});for(var o=0,r=e._deferreds.length;r>o;o++)t(e,e._deferreds[o]);e._deferreds=null}function f(e,n){var t=!1;try{e(function(e){t||(t=!0,o(n,e))},function(e){t||(t=!0,r(n,e))})}catch(i){if(t)return;t=!0,r(n,i)}}var u=function(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})},c=setTimeout;n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(n,o){var r=new this.constructor(e);return t(this,new function(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}(n,o,r)),r},n.prototype["finally"]=u,n.all=function(e){return new n(function(n,t){function o(e,f){try{if(f&&("object"==typeof f||"function"==typeof f)){var u=f.then;if("function"==typeof u)return void u.call(f,function(n){o(e,n)},t)}r[e]=f,0==--i&&n(r)}catch(c){t(c)}}if(!e||"undefined"==typeof e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return n([]);for(var i=r.length,f=0;r.length>f;f++)o(f,r[f])})},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n(function(n){n(e)})},n.reject=function(e){return new n(function(n,t){t(e)})},n.race=function(e){return new n(function(n,t){for(var o=0,r=e.length;r>o;o++)e[o].then(n,t)})},n._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){c(e,0)},n._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();l.Promise?l.Promise.prototype["finally"]||(l.Promise.prototype["finally"]=u):l.Promise=n});</script>

<script type="text/javascript" defer>
window.addEventListener('DOMContentLoaded', function() {
	// fetch.js
	window.carthookFetch="2.5.1",window.replaced_selectors=[],window.chRechargeHandleMap=window.chRechargeHandleMap||{},function(t){var e="form[action^='/cart']:not(form[action='/cart/add']), form[action^='/checkout']",o="input[name='checkout'][type='submit'], input[type='submit'], #recharge_button",n=".carthook_checkout, [name='update'], [name='add']",c="button[name='checkout'][type='submit'], button[type='button'].checkout",r=".carthook_checkout",a="a[name='checkout']:not(a[href='/cart'])",i=".carthook_checkout",s="#cartSpecialInstructions, #CartSpecialInstructions",u='[name^="attributes"]',l="carthook_ignore";window.chCartToken=null,window.chScriptLoaded=!1;var h=!1,d=!1;function w(t,e){window.ch_debug&&console.log(t,e)}function f(e){return new Promise(function(o,n){t.ajax({type:"GET",url:e,dataType:"json",success:o,error:n})})}function p(t){var e=function(t,e){if(!((o=t)&&o.properties&&o.properties.shipping_interval_frequency))return t.handle;var o;if(window.chRechargeHandleMap[t.handle])return window.chRechargeHandleMap[t.handle];var n=t.handle.match(/(.*)-[0-9]+$/);return n?n[1]:t.handle}(t);return w("Fetching",e),new Promise(function(t,o){(function(t){return f("/products/"+t+".js")})(e).then(function(e){var o=e.tags;if(o&&0!==o.length)if(o.some(function(t){return t.trim().toLowerCase()===l}))t(l);else{var n=o.reduce(function(t,e){return t||"carthook_checkout"===e.trim().toLowerCase()},!1);t(n)}else t(!1)}).catch(function(o){w("Product fetch err "+e+": "+o.status),t(!1)})})}function m(t){return new Promise(function(t,e){f("/cart.json").then(function(o){var n;if(window.chCartToken=o.token||(n="cart",(document.cookie.match("(^|; )"+n+"=([^;]*)")||0)[2]),o.items){var c=o.items.map(function(t){return p(t)});Promise.all(c).then(function(e){e.indexOf(l)>-1?t(!1):t(e.indexOf(!0)>-1)}).catch(function(t){e(t)})}else e("No items in the cart")}).catch(function(t){w("Error grabbing Shopify cart: "+t),e(t)})})}t.getScript("https://gcheck.carthook.com",function(){window.chScriptLoaded=!0}),window.onpageshow=function(t){t.persisted&&window.location.reload()},window.redirectToOriginal=function(e){var o=t(window.replaced_selectors[e]),n=o.get(0).tagName.toLowerCase();if(w("Tag name: ",n),"a"==n){var c=o.attr("href");""==c||null==c||void 0===c?o[0].click():(w("Redirecting to a with ref: ",c),window.location.href=c)}else o.click()},window.testGlobalBeforeReact=function(t){d||(d=!0,window.chScriptLoaded?window.react(t):window.redirectToOriginal(t))},window.react=function(e){var o=t("input[type='checkbox']#agree"),n=!o.length;if(o.length>0&&o.each(function(e,o){t(o).is(":checked")&&(n=!0)}),n)if(h)window.redirectToOriginal(e);else try{m().then(function(o){o?function(){w("Cart Token: ",window.chCartToken);var e="",o=t(s);o.length>0&&o.each(function(){if(""!=$(this).val())return e="&additionalNote="+encodeURIComponent($(this).val()),!1});var n=[],c="",r=t(u);r.length>0&&(r.each(function(){n.push({name:this.id?this.id:this.name,value:this.value})}),c="&noteAttributes="+encodeURIComponent(JSON.stringify(n)));var a="";if(window.chCouponCode&&void 0!==window.chCouponCode&&(a="&coupon="+window.chCouponCode),null!=window.chCartToken){var i="https://besynchro.com/a/secure/checkout/SKZu8EeB57h3S23Q0Qr7?cart_token="+window.chCartToken+a+e+c;null!=window.ch_cust_param&&(i+="&"+window.ch_cust_param),w("Checkout URL: ",i),window.location.href=i}}():redirectToOriginal(e)}).catch(function(t){w("Cart fetch error: ",t),window.redirectToOriginal(e)})}catch(t){w("Error when redirecting with error object: ",t),h=!0,window.redirectToOriginal(e)}else alert("You must agree to the Terms and Conditions first")},t(document).ready(function(){var s=function(){for(var t=e.split(", "),s=o.split(", "),u=c.split(", "),l=a.split(", "),h="",d="",w="",f=0;f<t.length;f++){var p=t[f];f>0&&f<t.length&&(h+=", ",d+=", ",w+=", ");for(var m=0;m<s.length;m++)m>0&&(h+=", "),h+=p+" "+s[m]+":not("+n+")";for(var k=0;k<u.length;k++)k>0&&(d+=", "),d+=p+" "+u[k]+":not("+r+")";for(var g=0;g<l.length;g++)g>0&&(w+=", "),w+=p+" "+l[g]+":not("+i+")"}return[h,d,w]}();t('<style id="ch-btn-style">input.carthook_checkout:not([class*="elm_pos_"]), .carthook_checkout[name="checkout"]:not([class*="elm_pos_"]) { display: none !important; }</style>').appendTo(document.head);!function(t,e,o){var n,c,r=(n=e,c=o,function(){if(void 0===c||c-- >0){setTimeout(r,n);try{t.call(null)}catch(t){throw c=0,t.toString()}}});try{t.call(null)}catch(t){console.error(t)}setTimeout(r,e)}(function(){w("run"),t(s[0]).each(function(e,o){e=window.replaced_selectors.length,t(o).addClass("carthook_checkout"),window.replaced_selectors.push(o);var n=document.createElement("input"),c=t(o).attr("class"),r=t(o).attr("style");n.setAttribute("type","submit"),n.setAttribute("value",o.value),n.setAttribute("class",c),n.className+=" carthook_checkout elm_pos_"+e,void 0!==r&&n.setAttribute("style",r),t(n).insertAfter($(o)),t(o).attr("style","display:none !important"),t(n).on("click touchstart",function(t){t.preventDefault(),window.testGlobalBeforeReact(e)}),w("Replaced: ",o)}),t(s[1]).each(function(e,o){e=window.replaced_selectors.length,t(o).addClass("carthook_checkout"),window.replaced_selectors.push(o);var n=document.createElement("button"),c=t(o).attr("class"),r=t(o).attr("style"),a=o.innerHTML;n.setAttribute("type","submit"),n.setAttribute("class",c),n.className+=" carthook_checkout elm_pos_"+e,void 0!==r&&n.setAttribute("style",r),t(n).html(a),t(n).insertAfter($(o)),t(o).hide(),t(n).on("click touchstart",function(t){t.preventDefault(),window.testGlobalBeforeReact(e)}),w("Replaced: ",o)}),t(s[2]).each(function(e,o){e=window.replaced_selectors.length,t(o).addClass("carthook_checkout"),window.replaced_selectors.push(o);var n=document.createElement("a"),c=t(o).attr("class"),r=t(o).attr("style"),a=o.innerHTML;n.setAttribute("class",c),n.className+=" carthook_checkout elm_pos_"+e,void 0!==r&&n.setAttribute("style",r),t(n).html(a),t(n).insertAfter($(o)),t(o).hide(),t(n).on("click touchstart",function(t){t.preventDefault(),window.testGlobalBeforeReact(e)}),w("Replaced: ",o)})},350)})}(jQuery);
});
</script>
